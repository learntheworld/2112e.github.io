<script src="blockly_compressed.js"></script>
<script src="blocks_compressed.js"></script>
<script src="python_compressed.js"></script>
<script src="msg/js/en.js"></script>

<div id="blocklyDiv" style="height: 480px; width: 600px;"></div>
  


  
<script>

  Blockly.Blocks['start'] = {
    init: function() {
      this.setNextStatement(true);
      this.setColour(160);
      this.appendDummyInput()
        .appendField("Start");
      this.setTooltip("Place this block at the start.")
      this.setHelpUrl("http://google.com");
    }
  };

  Blockly.Python['start'] = function(block) {
    var code = 'from pwm import *\n';
    return code;
  };
  
  Blockly.Blocks['forward'] = {
    init: function() {
      this.setNextStatement(true);
      this.setPreviousStatement(true);
      this.setColour(160);
      this.appendDummyInput()
          .appendField("forward");
      this.setTooltip('Move forward.');
      this.setHelpUrl('http://google.com');
    }
  };

  Blockly.Python['forward'] = function(block) {
    var code = 'forward()\n';
    return code;
  };

  Blockly.Blocks['backward'] = {
    init: function() {
      this.setNextStatement(true);
      this.setPreviousStatement(true);
      this.setColour(160);
      this.appendDummyInput()
          .appendField("backward");
  this.setTooltip('Move backward.');
      this.setHelpUrl('http://google.com');
    }
  };

  Blockly.Python['backward'] = function(block) {
    var code = 'backward()\n';
    return code;
  };

  Blockly.Blocks['left'] = {
    init: function() {
      this.setNextStatement(true);
      this.setPreviousStatement(true);
      this.setColour(160);
      this.appendDummyInput()
          .appendField("left");
      this.setTooltip('Turn left.');
      this.setHelpUrl('http://google.com');
    }
  };

  Blockly.Python['left'] = function(block) {
    var code = 'left()\n';
    return code;
  };

  Blockly.Blocks['right'] = {
    init: function() {
      this.setNextStatement(true);
      this.setPreviousStatement(true);
      this.setColour(160);
      this.appendDummyInput()
          .appendField("right");
      this.setTooltip('Turn right.');
      this.setHelpUrl('http://google.com');
    }
  };

  Blockly.Python['right'] = function(block) {
    var code = 'right()\n';
    return code;
  };

   Blockly.Blocks['stop'] = {
    init: function() {
      this.setNextStatement(true);
      this.setPreviousStatement(true);
      this.setColour(160);
      this.appendDummyInput()
          .appendField("Stop");
      this.setTooltip('Stops motion.');
      this.setHelpUrl('http://google.com');
    }
  };

  Blockly.Python['stop'] = function(block) {
    var code = 'stop()\n';
    return code;
  };
  
  Blockly.Blocks['wait'] = {
    init: function() {
      this.appendDummyInput()
          .appendField("wait")
          .appendField(new Blockly.FieldNumber(0), "NAME")
          .appendField("seconds");
      this.setInputsInline(true);
      this.setPreviousStatement(true, null);
      this.setNextStatement(true, null);
      this.setColour(230);
      this.setTooltip('');
      this.setHelpUrl('');
    }
  };
  
  Blockly.Python['wait'] = function(block){
    var number_name = block.getFieldValue('NAME');
    var code = 'time.sleep(float('+number_name+'))\n'
    return code;
  }
  
</script>

<xml id="toolbox" style="display: none">
    <block type="start"></block>
    <block type="controls_if"></block>
    <block type="controls_repeat_ext"></block>
    <block type="logic_compare"></block>
    <block type="math_number"></block>
    <block type="math_arithmetic"></block>
    <block type="text"></block>
    <block type="text_print"></block>
    <block type="forward"></block>
    <block type="backward"></block>
    <block type="left"></block>
    <block type="right"></block>
    <block type="wait"></block>
    <block type="stop"></block>
</xml>

  
<script>
  var workspace = Blockly.inject('blocklyDiv',
  {toolbox: document.getElementById('toolbox')});

  function download() {
    var filename = "mycode.py"
    var text = Blockly.Python.workspaceToCode(workspace)
    var element = document.createElement('a');
    element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
    element.setAttribute('download', filename);

    element.style.display = 'none';
    document.body.appendChild(element);

    element.click();

    document.body.removeChild(element);
  }
  
  
  </script>

<form onsubmit="download()">
  <input type="submit" value="Download">
  </form>
